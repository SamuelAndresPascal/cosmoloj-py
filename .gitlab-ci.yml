default:
  before_script:
    - echo $CONDA_HOME
    - PATH=$PATH:$CONDA_HOME/bin
    - python --version
    - conda --version
    - which python
    - conda init bash
    - conda create -n cosmoloj_py python=3.10
    - . ~/.bashrc
    - conda activate cosmoloj_py
    - which python
    - conda install pylint pytest-cov

  after_script:
    - PATH=$PATH:$CONDA_HOME/bin
    - python --version
    - conda --version
    - which python
    - conda init bash
    - . ~/.bashrc
    - conda activate cosmoloj_py
    - which python
    - conda remove pylint pytest-cov

stages:
  - lint
  - test
  - demo
  - pypi-package
  - pypi-publish
  - conda-package
  - sonar

include:
  - local: 'unit-simple/.gitlab-ci.yml'
  - local: 'taxref/.gitlab-ci.yml'

sonar:
  stage: sonar
  script:
    - $SONAR_SCANNER_HOME/bin/sonar-scanner -Dsonar.login=$SONAR_LOGIN
  artifacts:
    expire_in: 2 days
